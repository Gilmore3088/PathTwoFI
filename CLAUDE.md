# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

PathTwoFI is a personal finance blog and wealth tracking application focused on documenting a couple's journey to Financial Independence (FIRE). The application features public-facing blog content, wealth dashboards, and admin management tools.

## Technology Stack

- **Frontend**: React 18 + TypeScript, Wouter (routing), TanStack Query, Radix UI + Tailwind CSS
- **Backend**: Express.js with TypeScript
- **Database**: PostgreSQL with Drizzle ORM
- **Build Tools**: Vite (client), esbuild (server)
- **Authentication**: Replit Auth (OAuth-based)
- **Storage**: Google Cloud Storage for object/file uploads

## Common Commands

```bash
# Development
npm run dev              # Start dev server with hot reload (http://localhost:5173)

# Type Checking
npm run check            # Run TypeScript type checking (important before commits)

# Building
npm run build            # Build both client (Vite) and server (esbuild)
npm run start            # Start production server

# Database
npm run db:push          # Push schema changes to database using Drizzle Kit
```

## Project Structure

```
/client                  # React SPA
  /src
    /components          # UI components
      /ui                # Radix UI primitives + shadcn/ui components
      /dashboard         # Dashboard-specific components
      /blog              # Blog-specific components
      /goals             # Goals display components
      /layout            # Layout components (header, footer)
      /admin             # Admin panel components
    /pages               # Route components
    /lib                 # Client utilities
    /hooks               # Custom React hooks

/server                  # Express backend
  index.ts               # Server entry point
  routes.ts              # API route definitions
  storage.ts             # Data access layer (interface + implementation)
  db.ts                  # Drizzle database connection
  replitAuth.ts          # Authentication setup
  objectStorage.ts       # Google Cloud Storage integration

/shared                  # Shared between client/server
  schema.ts              # Drizzle schema definitions + Zod validation schemas

/migrations              # Database migrations (generated by Drizzle)
```

## Architecture Patterns

### Path Aliases
- `@/` → `client/src/`
- `@shared/` → `shared/`
- `@assets/` → `attached_assets/`

### Data Flow
1. **Client** → API request via TanStack Query hooks
2. **Server routes** (`routes.ts`) → validate with Zod schemas
3. **Storage layer** (`storage.ts`) → database operations via Drizzle ORM
4. **Database** → PostgreSQL (Neon serverless)

### Database Schema
The schema in `shared/schema.ts` includes:
- **users**: Replit auth users with role-based access (admin/user)
- **blogPosts**: Blog content with categories, tags, series support, and scheduling
- **contentSeries**: Learning path collections for blog posts
- **wealthData**: Financial snapshots with category support (His/Her/Both)
- **financialGoals**: Goal tracking with milestones
- **goalMilestones**: Sub-goals for financial goals
- **wealthReports**: Monthly/quarterly/annual financial reports
- **newsletterSubscriptions**: Email subscriptions
- **contactSubmissions**: Contact form messages

### Authentication & Authorization
- Uses Replit Auth (OAuth) configured in `server/replitAuth.ts`
- Middleware: `isAuthenticated`, `isAdmin`
- Admin routes are protected with `isAdmin` middleware
- Public routes: blog posts, wealth data (read-only), dashboard

### Category System
Wealth data and financial goals support three categories:
- "Both" - joint/combined finances
- "His" - individual tracking
- "Her" - individual tracking

### API Conventions
- RESTful endpoints under `/api/*`
- Validation using Zod schemas from `shared/schema.ts`
- Admin endpoints require `isAdmin` middleware
- Public endpoints: blog posts, wealth summaries, contact forms

## Important Implementation Details

### Blog System
- Posts support draft/published/scheduled status
- Posts can belong to content series (learning paths)
- Automatic view tracking on blog post reads
- SEO: sitemap.xml and RSS feed.xml auto-generated from posts
- Tags stored as PostgreSQL text arrays

### Wealth Tracking
- Main fields: netWorth, investments, cash, liabilities, fireTarget, savingsRate
- Extended breakdown: stocks, bonds, realEstate, crypto, commodities, retirement accounts
- Debt breakdown: mortgage, creditCards, studentLoans, autoLoans, etc.
- Monthly cash flow: income, expenses, savings
- Summary endpoint (`/api/wealth-data/summary`) computes trends, asset allocation, debt breakdown

### Object Storage
- Google Cloud Storage integration via `ObjectStorageService`
- Upload flow: client requests signed URL → uploads directly to GCS → URL stored in database
- Serving: `/objects/:objectPath` proxies files from GCS
- Requires `PRIVATE_OBJECT_DIR` environment variable

### Development Notes
- Server runs on port 5173 by default (configurable via PORT env var)
- Vite dev server integrates as Express middleware in development
- Production serves static files from `dist/public`
- TypeScript strict mode enabled - always run `npm run check` before committing

## Database Workflow

When modifying the schema:
1. Edit `shared/schema.ts`
2. Run `npm run db:push` to sync changes to database
3. Drizzle generates migrations in `/migrations` directory
4. Update Zod validation schemas if needed (createInsertSchema patterns)

## Environment Variables Required

- `DATABASE_URL`: PostgreSQL connection string (required)
- `REPLIT_DB_URL`: Replit database URL (for sessions)
- `NODE_ENV`: "development" or "production"
- `PRIVATE_OBJECT_DIR`: GCS bucket path for object storage
- `PORT`: Server port (default: 5173)
